
<html>
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII" />
  <title>dps310.c</title>

  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.5.1.min.js"></script>
</head>
<body>

<pre><code class = "cpp">
<a name="ln1">/**</a>
<a name="ln2"> * @addtogroup DPS310</a>
<a name="ln3"> *</a>
<a name="ln4"> */</a>
<a name="ln5">/** @{ */</a>
<a name="ln6">/** @file dps310.c</a>
<a name="ln7"> *</a>
<a name="ln8"> * @brief Implementation of DPS310 driver</a>
<a name="ln9"> * @author Otso Jousimaa &lt;otso@ojousima.net&gt;</a>
<a name="ln10"> * @date 2020-12-07</a>
<a name="ln11"> * @copyright Ruuvi Innovations, License MIT.</a>
<a name="ln12"> *</a>
<a name="ln13"> */</a>
<a name="ln14"> </a>
<a name="ln15">#include &quot;dps310.h&quot;</a>
<a name="ln16">#include &quot;dps310_reg.h&quot;</a>
<a name="ln17">#include &lt;stdbool.h&gt;</a>
<a name="ln18">#include &lt;stddef.h&gt;</a>
<a name="ln19">#include &lt;string.h&gt;</a>
<a name="ln20"> </a>
<a name="ln21">// Clear context without NULLing function pointers.</a>
<a name="ln22">static void dps310_ctx_clear (dps310_ctx_t * const p_ctx)</a>
<a name="ln23">{</a>
<a name="ln24">    p_ctx-&gt;device_status  = 0;</a>
<a name="ln25">    p_ctx-&gt;product_id     = 0;</a>
<a name="ln26">    p_ctx-&gt;revision_id    = 0;</a>
<a name="ln27">    p_ctx-&gt;temp_mr        = 0;</a>
<a name="ln28">    p_ctx-&gt;temp_osr       = 0;</a>
<a name="ln29">    p_ctx-&gt;pres_mr        = 0;</a>
<a name="ln30">    p_ctx-&gt;pres_osr       = 0;</a>
<a name="ln31">    p_ctx-&gt;c0             = 0;</a>
<a name="ln32">    p_ctx-&gt;c1             = 0;</a>
<a name="ln33">    p_ctx-&gt;c00            = 0;</a>
<a name="ln34">    p_ctx-&gt;c10            = 0;</a>
<a name="ln35">    p_ctx-&gt;c01            = 0;</a>
<a name="ln36">    p_ctx-&gt;c11            = 0;</a>
<a name="ln37">    p_ctx-&gt;c20            = 0;</a>
<a name="ln38">    p_ctx-&gt;c21            = 0;</a>
<a name="ln39">    p_ctx-&gt;c30            = 0;</a>
<a name="ln40">    p_ctx-&gt;last_temp_scal = 0;</a>
<a name="ln41">}</a>
<a name="ln42"> </a>
<a name="ln43">// Valid up to 31 bits</a>
<a name="ln44">static inline int32_t</a>
<a name="ln45">twos_complement (const uint32_t value, const uint8_t bits)</a>
<a name="ln46">{</a>
<a name="ln47">    const int32_t max_signed_value_exclusive = (int32_t) (1U &lt;&lt; (bits - 1U));</a>
<a name="ln48">    int32_t complement = (int32_t) value;</a>
<a name="ln49"> </a>
<a name="ln50">    if (complement &gt;= max_signed_value_exclusive)</a>
<a name="ln51">    {</a>
<a name="ln52">        complement -= 2 * max_signed_value_exclusive;</a>
<a name="ln53">    }</a>
<a name="ln54"> </a>
<a name="ln55">    return complement;</a>
<a name="ln56">}</a>
<a name="ln57"> </a>
<a name="ln58">static dps310_status_t ctx_status_check (const dps310_ctx_t * const ctx)</a>
<a name="ln59">{</a>
<a name="ln60">    dps310_status_t status = DPS310_SUCCESS;</a>
<a name="ln61"> </a>
<a name="ln62">    if ((NULL == ctx)</a>
<a name="ln63">            || (NULL == ctx-&gt;sleep)</a>
<a name="ln64">            || (NULL == ctx-&gt;write)</a>
<a name="ln65">            || (NULL == ctx-&gt;read))</a>
<a name="ln66">    {</a>
<a name="ln67">        status = DPS310_ERROR_NULL;</a>
<a name="ln68">    }</a>
<a name="ln69">    else if (ctx-&gt;device_status &gt; DPS310_MAX_OK)</a>
<a name="ln70">    {</a>
<a name="ln71">        status = ctx-&gt;device_status;</a>
<a name="ln72">    }</a>
<a name="ln73">    else if (DPS310_NOT_INITIALIZED == ctx-&gt;device_status)</a>
<a name="ln74">    {</a>
<a name="ln75">        status = DPS310_INVALID_STATE;</a>
<a name="ln76">    }</a>
<a name="ln77">    else</a>
<a name="ln78">    {</a>
<a name="ln79">        // No action needed.</a>
<a name="ln80">    }</a>
<a name="ln81"> </a>
<a name="ln82">    return status;</a>
<a name="ln83">}</a>
<a name="ln84"> </a>
<a name="ln85">static dps310_status_t ctx_ready_check (const dps310_ctx_t * const ctx)</a>
<a name="ln86">{</a>
<a name="ln87">    dps310_status_t status = DPS310_SUCCESS;</a>
<a name="ln88"> </a>
<a name="ln89">    if ((NULL == ctx)</a>
<a name="ln90">            || (NULL == ctx-&gt;sleep)</a>
<a name="ln91">            || (NULL == ctx-&gt;write)</a>
<a name="ln92">            || (NULL == ctx-&gt;read))</a>
<a name="ln93">    {</a>
<a name="ln94">        status = DPS310_ERROR_NULL;</a>
<a name="ln95">    }</a>
<a name="ln96">    // Bus error code must be returned as-is to application.</a>
<a name="ln97">    else if (DPS310_BUS_ERROR == ctx-&gt;device_status)</a>
<a name="ln98">    {</a>
<a name="ln99">        status = DPS310_BUS_ERROR;</a>
<a name="ln100">    }</a>
<a name="ln101">    // Other states can be interpreted as invalid state.</a>
<a name="ln102">    else if (DPS310_READY != ctx-&gt;device_status)</a>
<a name="ln103">    {</a>
<a name="ln104">        status = DPS310_INVALID_STATE;</a>
<a name="ln105">    }</a>
<a name="ln106">    else</a>
<a name="ln107">    {</a>
<a name="ln108">        // No action needed.</a>
<a name="ln109">    }</a>
<a name="ln110"> </a>
<a name="ln111">    return status;</a>
<a name="ln112">}</a>
<a name="ln113"> </a>
<a name="ln114">static dps310_status_t ctx_cont_check (const dps310_ctx_t * const ctx)</a>
<a name="ln115">{</a>
<a name="ln116">    dps310_status_t status = DPS310_SUCCESS;</a>
<a name="ln117"> </a>
<a name="ln118">    if ((NULL == ctx)</a>
<a name="ln119">            || (NULL == ctx-&gt;sleep)</a>
<a name="ln120">            || (NULL == ctx-&gt;write)</a>
<a name="ln121">            || (NULL == ctx-&gt;read))</a>
<a name="ln122">    {</a>
<a name="ln123">        status = DPS310_ERROR_NULL;</a>
<a name="ln124">    }</a>
<a name="ln125">    // Bus error code must be returned as-is to application.</a>
<a name="ln126">    else if (DPS310_BUS_ERROR == ctx-&gt;device_status)</a>
<a name="ln127">    {</a>
<a name="ln128">        status = DPS310_BUS_ERROR;</a>
<a name="ln129">    }</a>
<a name="ln130">    // Other states can be interpreted as invalid state.</a>
<a name="ln131">    else if (DPS310_CONTINUOUS != ctx-&gt;device_status)</a>
<a name="ln132">    {</a>
<a name="ln133">        status = DPS310_INVALID_STATE;</a>
<a name="ln134">    }</a>
<a name="ln135">    else</a>
<a name="ln136">    {</a>
<a name="ln137">        // No action needed.</a>
<a name="ln138">    }</a>
<a name="ln139"> </a>
<a name="ln140">    return status;</a>
<a name="ln141">}</a>
<a name="ln142"> </a>
<a name="ln143">static dps310_status_t ctx_done_check (const dps310_ctx_t * const ctx)</a>
<a name="ln144">{</a>
<a name="ln145">    dps310_status_t status = DPS310_SUCCESS;</a>
<a name="ln146"> </a>
<a name="ln147">    if ((NULL == ctx)</a>
<a name="ln148">            || (NULL == ctx-&gt;sleep)</a>
<a name="ln149">            || (NULL == ctx-&gt;write)</a>
<a name="ln150">            || (NULL == ctx-&gt;read))</a>
<a name="ln151">    {</a>
<a name="ln152">        status = DPS310_ERROR_NULL;</a>
<a name="ln153">    }</a>
<a name="ln154">    // Bus error code must be returned as-is to application.</a>
<a name="ln155">    else if (DPS310_BUS_ERROR == ctx-&gt;device_status)</a>
<a name="ln156">    {</a>
<a name="ln157">        status = DPS310_BUS_ERROR;</a>
<a name="ln158">    }</a>
<a name="ln159">    // Other states can be interpreted as invalid state.</a>
<a name="ln160">    else if ((DPS310_TEMP_RDY != ctx-&gt;device_status)</a>
<a name="ln161">             &amp;&amp; (DPS310_PRES_RDY != ctx-&gt;device_status))</a>
<a name="ln162">    {</a>
<a name="ln163">        status = DPS310_INVALID_STATE;</a>
<a name="ln164">    }</a>
<a name="ln165">    else</a>
<a name="ln166">    {</a>
<a name="ln167">        // No action needed.</a>
<a name="ln168">    }</a>
<a name="ln169"> </a>
<a name="ln170">    return status;</a>
<a name="ln171">}</a>
<a name="ln172"> </a>
<a name="ln173">static __attribute__ ((nonnull)) dps310_status_t</a>
<a name="ln174">read_coefs (dps310_ctx_t * const ctx)</a>
<a name="ln175">{</a>
<a name="ln176">    uint8_t coefs[DPS310_COEF_REG_LEN] = {0};</a>
<a name="ln177">    dps310_status_t reg_read_ret = ctx-&gt;read (ctx-&gt;comm_ctx, DPS310_COEF_START_REG,</a>
<a name="ln178">                                   coefs, DPS310_COEF_REG_LEN);</a>
<a name="ln179">    uint32_t reg_val = (((uint32_t) coefs[DPS310_COEF_C0_OFFSET] * 256U)</a>
<a name="ln180">                        + ((uint32_t) coefs[DPS310_COEF_C0_OFFSET + 1U]))</a>
<a name="ln181">                       &gt;&gt; DPS310_COEF_C0_SHIFT;</a>
<a name="ln182">    ctx-&gt;c0 = twos_complement (reg_val, DPS310_COEF_C0_LEN_BITS);</a>
<a name="ln183">    reg_val = (((uint32_t) coefs[DPS310_COEF_C1_OFFSET] * 256U)</a>
<a name="ln184">               + ((uint32_t) coefs[DPS310_COEF_C1_OFFSET + 1U]))</a>
<a name="ln185">              &amp; ((1U &lt;&lt; DPS310_COEF_C1_LEN_BITS) - 1U);</a>
<a name="ln186">    ctx-&gt;c1 = twos_complement (reg_val, DPS310_COEF_C1_LEN_BITS);</a>
<a name="ln187">    reg_val = (((uint32_t) coefs[DPS310_COEF_C00_OFFSET] * 256U * 256U)</a>
<a name="ln188">               + ((uint32_t) coefs[DPS310_COEF_C00_OFFSET + 1U] * 256U)</a>
<a name="ln189">               + ((uint32_t) coefs[DPS310_COEF_C00_OFFSET + 2U]))</a>
<a name="ln190">              &gt;&gt; DPS310_COEF_C00_SHIFT;</a>
<a name="ln191">    ctx-&gt;c00 = twos_complement (reg_val, DPS310_COEF_C00_LEN_BITS);</a>
<a name="ln192">    reg_val = (((uint32_t) coefs[DPS310_COEF_C10_OFFSET] * 256U * 256U)</a>
<a name="ln193">               + ((uint32_t) coefs[DPS310_COEF_C10_OFFSET + 1U] * 256U)</a>
<a name="ln194">               + ((uint32_t) coefs[DPS310_COEF_C10_OFFSET + 2U]))</a>
<a name="ln195">              &amp; ((1U &lt;&lt; DPS310_COEF_C10_LEN_BITS) - 1U);</a>
<a name="ln196">    ctx-&gt;c10 = twos_complement (reg_val, DPS310_COEF_C10_LEN_BITS);</a>
<a name="ln197">    reg_val = (((uint32_t) coefs[DPS310_COEF_C01_OFFSET] * 256U)</a>
<a name="ln198">               + ((uint32_t) coefs[DPS310_COEF_C01_OFFSET + 1U]));</a>
<a name="ln199">    ctx-&gt;c01 = twos_complement (reg_val, DPS310_COEF_C01_LEN_BITS);</a>
<a name="ln200">    reg_val = (((uint32_t) coefs[DPS310_COEF_C11_OFFSET] * 256U)</a>
<a name="ln201">               + ((uint32_t) coefs[DPS310_COEF_C11_OFFSET + 1U]));</a>
<a name="ln202">    ctx-&gt;c11 = twos_complement (reg_val, DPS310_COEF_C01_LEN_BITS);</a>
<a name="ln203">    reg_val = (((uint32_t) coefs[DPS310_COEF_C20_OFFSET] * 256U)</a>
<a name="ln204">               + ((uint32_t) coefs[DPS310_COEF_C20_OFFSET + 1U]));</a>
<a name="ln205">    ctx-&gt;c20 = twos_complement (reg_val, DPS310_COEF_C20_LEN_BITS);</a>
<a name="ln206">    reg_val = (((uint32_t) coefs[DPS310_COEF_C21_OFFSET] * 256U)</a>
<a name="ln207">               + ((uint32_t) coefs[DPS310_COEF_C21_OFFSET + 1U]));</a>
<a name="ln208">    ctx-&gt;c21 = twos_complement (reg_val, DPS310_COEF_C21_LEN_BITS);</a>
<a name="ln209">    reg_val = (((uint32_t) coefs[DPS310_COEF_C30_OFFSET] * 256U)</a>
<a name="ln210">               + ((uint32_t) coefs[DPS310_COEF_C30_OFFSET + 1U]));</a>
<a name="ln211">    ctx-&gt;c30 = twos_complement (reg_val, DPS310_COEF_C30_LEN_BITS);</a>
<a name="ln212">    return reg_read_ret;</a>
<a name="ln213">}</a>
<a name="ln214"> </a>
<a name="ln215">static __attribute__ ((nonnull)) dps310_status_t</a>
<a name="ln216">soft_reset (dps310_ctx_t * const ctx)</a>
<a name="ln217">{</a>
<a name="ln218">    dps310_status_t status = DPS310_SUCCESS;</a>
<a name="ln219">    uint8_t cmd = DPS310_SOFT_RST_VAL;</a>
<a name="ln220">    status |= ctx-&gt;write (ctx-&gt;comm_ctx, DPS310_RST_CFG_REG, &amp;cmd, 1U);</a>
<a name="ln221"> </a>
<a name="ln222">    if (DPS310_SUCCESS == status)</a>
<a name="ln223">    {</a>
<a name="ln224">        ctx-&gt;device_status = DPS310_READY;</a>
<a name="ln225">    }</a>
<a name="ln226">    else</a>
<a name="ln227">    {</a>
<a name="ln228">        status |= DPS310_BUS_ERROR;</a>
<a name="ln229">        ctx-&gt;device_status = DPS310_BUS_ERROR;</a>
<a name="ln230">    }</a>
<a name="ln231"> </a>
<a name="ln232">    return status;</a>
<a name="ln233">}</a>
<a name="ln234"> </a>
<a name="ln235">static __attribute__ ((nonnull)) dps310_status_t</a>
<a name="ln236">read_revision (dps310_ctx_t * const ctx)</a>
<a name="ln237">{</a>
<a name="ln238">    dps310_status_t status = ctx_ready_check (ctx);</a>
<a name="ln239">    uint8_t revision[1U] = {0xFFU};</a>
<a name="ln240"> </a>
<a name="ln241">    if (DPS310_SUCCESS == status)</a>
<a name="ln242">    {</a>
<a name="ln243">        status |= ctx-&gt;read (ctx-&gt;comm_ctx, DPS310_PROD_ID_REG, revision, 1U);</a>
<a name="ln244"> </a>
<a name="ln245">        if (DPS310_SUCCESS == status)</a>
<a name="ln246">        {</a>
<a name="ln247">            ctx-&gt;product_id = revision[0U]  &amp; DPS310_PROD_ID_MASK;</a>
<a name="ln248">            ctx-&gt;revision_id = (revision[0U] &amp; DPS310_PROD_ID_REV_MASK)</a>
<a name="ln249">                               &gt;&gt; DPS310_PROD_ID_REV_SHIFT;</a>
<a name="ln250"> </a>
<a name="ln251">            if ((DPS310_PRODUCT_ID_VAL != ctx-&gt;product_id)</a>
<a name="ln252">                    || (DPS310_REVISION_ID_VAL != ctx-&gt;revision_id))</a>
<a name="ln253">            {</a>
<a name="ln254">                status |= DPS310_UNKNOWN_REV;</a>
<a name="ln255">                ctx-&gt;device_status = DPS310_UNKNOWN_REV;</a>
<a name="ln256">            }</a>
<a name="ln257">        }</a>
<a name="ln258">        else</a>
<a name="ln259">        {</a>
<a name="ln260">            status |= DPS310_BUS_ERROR;</a>
<a name="ln261">            ctx-&gt;device_status = DPS310_BUS_ERROR;</a>
<a name="ln262">        }</a>
<a name="ln263">    }</a>
<a name="ln264"> </a>
<a name="ln265">    return status;</a>
<a name="ln266">}</a>
<a name="ln267"> </a>
<a name="ln268">// Undocumented workaround for undocumented feature of DPS310, lifted from</a>
<a name="ln269">// DPS310 Arduino driver.</a>
<a name="ln270">// https://github.com/Infineon/DPS310-Pressure-Sensor/blob/888200c7efd8edb19ce69a2144e28ba31cdad449/src/DpsClass.cpp#L448</a>
<a name="ln271">static __attribute__ ((nonnull))</a>
<a name="ln272">dps310_status_t efuse_write (dps310_ctx_t * const ctx)</a>
<a name="ln273">{</a>
<a name="ln274">    dps310_status_t ret_code = ctx_ready_check (ctx);</a>
<a name="ln275"> </a>
<a name="ln276">    if (DPS310_SUCCESS == ret_code)</a>
<a name="ln277">    {</a>
<a name="ln278">        uint8_t regs[5U] =</a>
<a name="ln279">        {</a>
<a name="ln280">            DPS310_EFUSE_0_REG,</a>
<a name="ln281">            DPS310_EFUSE_1_REG,</a>
<a name="ln282">            DPS310_EFUSE_2_REG,</a>
<a name="ln283">            DPS310_EFUSE_0_REG,</a>
<a name="ln284">            DPS310_EFUSE_1_REG</a>
<a name="ln285">        };</a>
<a name="ln286">        uint8_t cmds[5U] =</a>
<a name="ln287">        {</a>
<a name="ln288">            DPS310_EFUSE_0_VAL,</a>
<a name="ln289">            DPS310_EFUSE_1_VAL,</a>
<a name="ln290">            DPS310_EFUSE_2_VAL,</a>
<a name="ln291">            0U,</a>
<a name="ln292">            0U</a>
<a name="ln293">        };</a>
<a name="ln294">        uint8_t cmd_idx = 0U;</a>
<a name="ln295"> </a>
<a name="ln296">        while ((cmd_idx &lt; sizeof (cmds)) &amp;&amp; (DPS310_SUCCESS == ret_code))</a>
<a name="ln297">        {</a>
<a name="ln298">            ret_code = ctx-&gt;write (ctx-&gt;comm_ctx, regs[cmd_idx], &amp;cmds[cmd_idx], 1U);</a>
<a name="ln299">            cmd_idx++;</a>
<a name="ln300">        }</a>
<a name="ln301"> </a>
<a name="ln302">        if (DPS310_SUCCESS != ret_code)</a>
<a name="ln303">        {</a>
<a name="ln304">            ret_code |= DPS310_BUS_ERROR;</a>
<a name="ln305">            ctx-&gt;device_status = DPS310_BUS_ERROR;</a>
<a name="ln306">        }</a>
<a name="ln307">    }</a>
<a name="ln308"> </a>
<a name="ln309">    return ret_code;</a>
<a name="ln310">}</a>
<a name="ln311"> </a>
<a name="ln312">dps310_status_t dps310_init (dps310_ctx_t * const ctx)</a>
<a name="ln313">{</a>
<a name="ln314">    dps310_status_t err_code = DPS310_SUCCESS;</a>
<a name="ln315"> </a>
<a name="ln316">    // ctx_status_check would fail on uninitialized context which isn't purposeful here.</a>
<a name="ln317">    if ((NULL == ctx)</a>
<a name="ln318">            || (NULL == ctx-&gt;sleep)</a>
<a name="ln319">            || (NULL == ctx-&gt;write)</a>
<a name="ln320">            || (NULL == ctx-&gt;read))</a>
<a name="ln321">    {</a>
<a name="ln322">        err_code = DPS310_ERROR_NULL;</a>
<a name="ln323">    }</a>
<a name="ln324">    else</a>
<a name="ln325">    {</a>
<a name="ln326">        ctx-&gt;sleep (DPS310_POR_DELAY_MS);</a>
<a name="ln327">        err_code |= soft_reset (ctx);</a>
<a name="ln328">        ctx-&gt;sleep (DPS310_COEF_DELAY_MS);</a>
<a name="ln329">        err_code |= read_revision (ctx);</a>
<a name="ln330">        err_code |= efuse_write (ctx);</a>
<a name="ln331">        err_code |= read_coefs (ctx);</a>
<a name="ln332">        err_code |= dps310_config_temp (ctx, DPS310_DEFAULT_MR, DPS310_DEFAULT_OS);</a>
<a name="ln333">        err_code |= dps310_config_pres (ctx, DPS310_DEFAULT_MR, DPS310_DEFAULT_OS);</a>
<a name="ln334">    }</a>
<a name="ln335"> </a>
<a name="ln336">    return err_code;</a>
<a name="ln337">}</a>
<a name="ln338"> </a>
<a name="ln339">static __attribute__ ((nonnull))</a>
<a name="ln340">dps310_status_t set_mr_reg (uint8_t * const reg, const dps310_mr_t mr)</a>
<a name="ln341">{</a>
<a name="ln342">    dps310_status_t err_code = DPS310_SUCCESS;</a>
<a name="ln343">    *reg &amp;= ~DPS310_MR_MASK;</a>
<a name="ln344"> </a>
<a name="ln345">    switch (mr)</a>
<a name="ln346">    {</a>
<a name="ln347">        // Switching sensor to off is controlled by a separate register, NONE has no effect.</a>
<a name="ln348">        case DPS310_MR_NONE:</a>
<a name="ln349">        case DPS310_MR_1:</a>
<a name="ln350">            *reg |= DPS310_MR_VAL_1;</a>
<a name="ln351">            break;</a>
<a name="ln352"> </a>
<a name="ln353">        case DPS310_MR_2:</a>
<a name="ln354">            *reg |= DPS310_MR_VAL_2;</a>
<a name="ln355">            break;</a>
<a name="ln356"> </a>
<a name="ln357">        case DPS310_MR_4:</a>
<a name="ln358">            *reg |= DPS310_MR_VAL_4;</a>
<a name="ln359">            break;</a>
<a name="ln360"> </a>
<a name="ln361">        case DPS310_MR_8:</a>
<a name="ln362">            *reg |= DPS310_MR_VAL_8;</a>
<a name="ln363">            break;</a>
<a name="ln364"> </a>
<a name="ln365">        case DPS310_MR_16:</a>
<a name="ln366">            *reg |= DPS310_MR_VAL_16;</a>
<a name="ln367">            break;</a>
<a name="ln368"> </a>
<a name="ln369">        case DPS310_MR_32:</a>
<a name="ln370">            *reg |= DPS310_MR_VAL_32;</a>
<a name="ln371">            break;</a>
<a name="ln372"> </a>
<a name="ln373">        case DPS310_MR_64:</a>
<a name="ln374">            *reg |= DPS310_MR_VAL_64;</a>
<a name="ln375">            break;</a>
<a name="ln376"> </a>
<a name="ln377">        case DPS310_MR_128:</a>
<a name="ln378">            *reg |= DPS310_MR_VAL_128;</a>
<a name="ln379">            break;</a>
<a name="ln380"> </a>
<a name="ln381">        default:</a>
<a name="ln382">            err_code = DPS310_INVALID_PARAM;</a>
<a name="ln383">            break;</a>
<a name="ln384">    }</a>
<a name="ln385"> </a>
<a name="ln386">    return err_code;</a>
<a name="ln387">}</a>
<a name="ln388"> </a>
<a name="ln389">static __attribute__ ((nonnull)) dps310_status_t</a>
<a name="ln390">set_os_reg (uint8_t * const reg, const dps310_os_t os)</a>
<a name="ln391">{</a>
<a name="ln392">    dps310_status_t err_code = DPS310_SUCCESS;</a>
<a name="ln393">    *reg &amp;= ~DPS310_OS_MASK;</a>
<a name="ln394"> </a>
<a name="ln395">    switch (os)</a>
<a name="ln396">    {</a>
<a name="ln397">        case DPS310_OS_1:</a>
<a name="ln398">            *reg |= DPS310_OS_VAL_1;</a>
<a name="ln399">            break;</a>
<a name="ln400"> </a>
<a name="ln401">        case DPS310_OS_2:</a>
<a name="ln402">            *reg |= DPS310_OS_VAL_2;</a>
<a name="ln403">            break;</a>
<a name="ln404"> </a>
<a name="ln405">        case DPS310_OS_4:</a>
<a name="ln406">            *reg |= DPS310_OS_VAL_4;</a>
<a name="ln407">            break;</a>
<a name="ln408"> </a>
<a name="ln409">        case DPS310_OS_8:</a>
<a name="ln410">            *reg |= DPS310_OS_VAL_8;</a>
<a name="ln411">            break;</a>
<a name="ln412"> </a>
<a name="ln413">        case DPS310_OS_16:</a>
<a name="ln414">            *reg |= DPS310_OS_VAL_16;</a>
<a name="ln415">            break;</a>
<a name="ln416"> </a>
<a name="ln417">        case DPS310_OS_32:</a>
<a name="ln418">            *reg |= DPS310_OS_VAL_32;</a>
<a name="ln419">            break;</a>
<a name="ln420"> </a>
<a name="ln421">        case DPS310_OS_64:</a>
<a name="ln422">            *reg |= DPS310_OS_VAL_64;</a>
<a name="ln423">            break;</a>
<a name="ln424"> </a>
<a name="ln425">        case DPS310_OS_128:</a>
<a name="ln426">            *reg |= DPS310_OS_VAL_128;</a>
<a name="ln427">            break;</a>
<a name="ln428"> </a>
<a name="ln429">        default:</a>
<a name="ln430">            err_code = DPS310_INVALID_PARAM;</a>
<a name="ln431">            break;</a>
<a name="ln432">    }</a>
<a name="ln433"> </a>
<a name="ln434">    return err_code;</a>
<a name="ln435">}</a>
<a name="ln436"> </a>
<a name="ln437">static __attribute__ ((nonnull)) dps310_status_t</a>
<a name="ln438">mask_set (const dps310_ctx_t * const ctx, const uint8_t reg_addr,</a>
<a name="ln439">          const uint8_t value, const uint8_t mask)</a>
<a name="ln440">{</a>
<a name="ln441">    dps310_status_t err_code = DPS310_SUCCESS;</a>
<a name="ln442">    uint8_t reg_val = 0;</a>
<a name="ln443">    err_code |= ctx-&gt;read (ctx-&gt;comm_ctx, reg_addr, &amp;reg_val, 1U);</a>
<a name="ln444">    reg_val |= (value &amp; mask);</a>
<a name="ln445">    err_code |= ctx-&gt;write (ctx-&gt;comm_ctx, reg_addr, &amp;reg_val, 1U);</a>
<a name="ln446">    return err_code;</a>
<a name="ln447">}</a>
<a name="ln448"> </a>
<a name="ln449">static __attribute__ ((nonnull)) dps310_status_t</a>
<a name="ln450">temp_coef_src_setup (const dps310_ctx_t * const ctx, uint8_t * const cmd)</a>
<a name="ln451">{</a>
<a name="ln452">    dps310_status_t err_code = DPS310_SUCCESS;</a>
<a name="ln453">    uint8_t coef_src = 0U;</a>
<a name="ln454">    err_code |= ctx-&gt;read (ctx-&gt;comm_ctx, DPS310_COEF_SRC_REG, &amp;coef_src, 1U);</a>
<a name="ln455">    *cmd &amp;= ~DPS310_COEF_SRC_MASK;</a>
<a name="ln456">    *cmd |= coef_src &amp; DPS310_COEF_SRC_MASK;</a>
<a name="ln457">    return err_code;</a>
<a name="ln458">}</a>
<a name="ln459"> </a>
<a name="ln460">dps310_status_t</a>
<a name="ln461">dps310_config_temp (dps310_ctx_t * const ctx, const dps310_mr_t temp_mr,</a>
<a name="ln462">                    const dps310_os_t temp_osr)</a>
<a name="ln463">{</a>
<a name="ln464">    dps310_status_t err_code = ctx_ready_check (ctx);</a>
<a name="ln465">    uint8_t cmd = 0U;</a>
<a name="ln466"> </a>
<a name="ln467">    if (DPS310_SUCCESS == err_code)</a>
<a name="ln468">    {</a>
<a name="ln469">        err_code |= set_mr_reg (&amp;cmd, temp_mr);</a>
<a name="ln470">        err_code |= set_os_reg (&amp;cmd, temp_osr);</a>
<a name="ln471"> </a>
<a name="ln472">        if (DPS310_SUCCESS == err_code)</a>
<a name="ln473">        {</a>
<a name="ln474">            err_code |= temp_coef_src_setup (ctx, &amp;cmd);</a>
<a name="ln475">            err_code |= ctx-&gt;write (ctx-&gt;comm_ctx, DPS310_TEMP_CFG_REG, &amp;cmd, 1U);</a>
<a name="ln476"> </a>
<a name="ln477">            if (temp_osr &gt;= DPS310_OS_16)</a>
<a name="ln478">            {</a>
<a name="ln479">                const uint8_t temp_shift_enable = DPS310_CFG_TEMPSH_MASK;</a>
<a name="ln480">                err_code |=  mask_set (ctx,</a>
<a name="ln481">                                       DPS310_CFG_REG,</a>
<a name="ln482">                                       temp_shift_enable,</a>
<a name="ln483">                                       DPS310_CFG_TEMPSH_MASK);</a>
<a name="ln484">            }</a>
<a name="ln485"> </a>
<a name="ln486">            if (DPS310_SUCCESS == err_code)</a>
<a name="ln487">            {</a>
<a name="ln488">                ctx-&gt;temp_mr = temp_mr;</a>
<a name="ln489">                ctx-&gt;temp_osr = temp_osr;</a>
<a name="ln490">            }</a>
<a name="ln491">            else</a>
<a name="ln492">            {</a>
<a name="ln493">                err_code |= DPS310_BUS_ERROR;</a>
<a name="ln494">                ctx-&gt;device_status = DPS310_BUS_ERROR;</a>
<a name="ln495">            }</a>
<a name="ln496">        }</a>
<a name="ln497">    }</a>
<a name="ln498"> </a>
<a name="ln499">    return err_code;</a>
<a name="ln500">}</a>
<a name="ln501"> </a>
<a name="ln502">dps310_status_t dps310_config_pres (dps310_ctx_t * const ctx, const dps310_mr_t pres_mr,</a>
<a name="ln503">                                    const dps310_os_t pres_osr)</a>
<a name="ln504">{</a>
<a name="ln505">    dps310_status_t err_code = ctx_ready_check (ctx);</a>
<a name="ln506">    uint8_t cmd = 0U;</a>
<a name="ln507"> </a>
<a name="ln508">    if (DPS310_SUCCESS == err_code)</a>
<a name="ln509">    {</a>
<a name="ln510">        err_code |= set_mr_reg (&amp;cmd, pres_mr);</a>
<a name="ln511">        err_code |= set_os_reg (&amp;cmd, pres_osr);</a>
<a name="ln512"> </a>
<a name="ln513">        if (DPS310_SUCCESS == err_code)</a>
<a name="ln514">        {</a>
<a name="ln515">            err_code |= ctx-&gt;write (ctx-&gt;comm_ctx, DPS310_PRES_CFG_REG, &amp;cmd, 1U);</a>
<a name="ln516"> </a>
<a name="ln517">            if (pres_osr &gt;= DPS310_OS_16)</a>
<a name="ln518">            {</a>
<a name="ln519">                const uint8_t pres_shift_enable = DPS310_CFG_PRESSH_MASK;</a>
<a name="ln520">                err_code |=  mask_set (ctx,</a>
<a name="ln521">                                       DPS310_CFG_REG,</a>
<a name="ln522">                                       pres_shift_enable,</a>
<a name="ln523">                                       DPS310_CFG_PRESSH_MASK);</a>
<a name="ln524">            }</a>
<a name="ln525"> </a>
<a name="ln526">            if (DPS310_SUCCESS == err_code)</a>
<a name="ln527">            {</a>
<a name="ln528">                ctx-&gt;pres_mr = pres_mr;</a>
<a name="ln529">                ctx-&gt;pres_osr = pres_osr;</a>
<a name="ln530">            }</a>
<a name="ln531">            else</a>
<a name="ln532">            {</a>
<a name="ln533">                err_code |= DPS310_BUS_ERROR;</a>
<a name="ln534">                ctx-&gt;device_status = DPS310_BUS_ERROR;</a>
<a name="ln535">            }</a>
<a name="ln536">        }</a>
<a name="ln537">    }</a>
<a name="ln538"> </a>
<a name="ln539">    return err_code;</a>
<a name="ln540">}</a>
<a name="ln541"> </a>
<a name="ln542">dps310_status_t dps310_standby (dps310_ctx_t * const ctx)</a>
<a name="ln543">{</a>
<a name="ln544">    dps310_status_t err_code = ctx_status_check (ctx);</a>
<a name="ln545"> </a>
<a name="ln546">    if (DPS310_SUCCESS == err_code)</a>
<a name="ln547">    {</a>
<a name="ln548">        uint8_t cmd = DPS310_MODE_STANDBY_VAL;</a>
<a name="ln549">        err_code |= ctx-&gt;write (ctx-&gt;comm_ctx, DPS310_MEAS_CFG_REG, &amp;cmd, 1U);</a>
<a name="ln550"> </a>
<a name="ln551">        if (DPS310_SUCCESS == err_code)</a>
<a name="ln552">        {</a>
<a name="ln553">            ctx-&gt;device_status = DPS310_READY;</a>
<a name="ln554">        }</a>
<a name="ln555">        else</a>
<a name="ln556">        {</a>
<a name="ln557">            err_code |= DPS310_BUS_ERROR;</a>
<a name="ln558">            ctx-&gt;device_status = DPS310_BUS_ERROR;</a>
<a name="ln559">        }</a>
<a name="ln560">    }</a>
<a name="ln561"> </a>
<a name="ln562">    return err_code;</a>
<a name="ln563">}</a>
<a name="ln564"> </a>
<a name="ln565">dps310_status_t dps310_uninit (dps310_ctx_t * const ctx)</a>
<a name="ln566">{</a>
<a name="ln567">    dps310_status_t err_code = dps310_standby (ctx);</a>
<a name="ln568">    dps310_ctx_clear (ctx);</a>
<a name="ln569">    return err_code;</a>
<a name="ln570">}</a>
<a name="ln571"> </a>
<a name="ln572">static uint8_t os_to_num (const dps310_os_t os)</a>
<a name="ln573">{</a>
<a name="ln574">    uint8_t num = 0;</a>
<a name="ln575"> </a>
<a name="ln576">    switch (os)</a>
<a name="ln577">    {</a>
<a name="ln578">        case DPS310_OS_1:</a>
<a name="ln579">            num = 1U;</a>
<a name="ln580">            break;</a>
<a name="ln581"> </a>
<a name="ln582">        case DPS310_OS_2:</a>
<a name="ln583">            num = 2U;</a>
<a name="ln584">            break;</a>
<a name="ln585"> </a>
<a name="ln586">        case DPS310_OS_4:</a>
<a name="ln587">            num = 4U;</a>
<a name="ln588">            break;</a>
<a name="ln589"> </a>
<a name="ln590">        case DPS310_OS_8:</a>
<a name="ln591">            num = 8U;</a>
<a name="ln592">            break;</a>
<a name="ln593"> </a>
<a name="ln594">        case DPS310_OS_16:</a>
<a name="ln595">            num = 16U;</a>
<a name="ln596">            break;</a>
<a name="ln597"> </a>
<a name="ln598">        case DPS310_OS_32:</a>
<a name="ln599">            num = 32U;</a>
<a name="ln600">            break;</a>
<a name="ln601"> </a>
<a name="ln602">        case DPS310_OS_64:</a>
<a name="ln603">            num = 64U;</a>
<a name="ln604">            break;</a>
<a name="ln605"> </a>
<a name="ln606">        case DPS310_OS_128:</a>
<a name="ln607">            num = 128U;</a>
<a name="ln608">            break;</a>
<a name="ln609"> </a>
<a name="ln610">        default:</a>
<a name="ln611">            num = 0;</a>
<a name="ln612">            break;</a>
<a name="ln613">    }</a>
<a name="ln614"> </a>
<a name="ln615">    return num;</a>
<a name="ln616">}</a>
<a name="ln617"> </a>
<a name="ln618">static uint32_t measurement_time_get (const dps310_os_t os)</a>
<a name="ln619">{</a>
<a name="ln620">    // Actually 2 + 1.6 * OSR, but rounding up.</a>
<a name="ln621">    return 3U + (uint32_t) (1.6F * (float) os_to_num (os));</a>
<a name="ln622">}</a>
<a name="ln623"> </a>
<a name="ln624">dps310_status_t</a>
<a name="ln625">dps310_measure_temp_once_sync (dps310_ctx_t * const ctx, float * const result)</a>
<a name="ln626">{</a>
<a name="ln627">    dps310_status_t err_code = ctx_ready_check (ctx);</a>
<a name="ln628"> </a>
<a name="ln629">    if (NULL == result)</a>
<a name="ln630">    {</a>
<a name="ln631">        err_code = DPS310_ERROR_NULL;</a>
<a name="ln632">    }</a>
<a name="ln633">    else if (DPS310_SUCCESS == err_code)</a>
<a name="ln634">    {</a>
<a name="ln635">        err_code |= dps310_measure_temp_once_async (ctx);</a>
<a name="ln636">        ctx-&gt;sleep (measurement_time_get (ctx-&gt;temp_osr));</a>
<a name="ln637">        err_code |= dps310_get_single_result (ctx, result);</a>
<a name="ln638">    }</a>
<a name="ln639">    else</a>
<a name="ln640">    {</a>
<a name="ln641">        // No action needed.</a>
<a name="ln642">    }</a>
<a name="ln643"> </a>
<a name="ln644">    return err_code;</a>
<a name="ln645">}</a>
<a name="ln646"> </a>
<a name="ln647">dps310_status_t dps310_measure_temp_once_async (dps310_ctx_t * const ctx)</a>
<a name="ln648">{</a>
<a name="ln649">    dps310_status_t err_code = ctx_ready_check (ctx);</a>
<a name="ln650"> </a>
<a name="ln651">    if (DPS310_SUCCESS == err_code)</a>
<a name="ln652">    {</a>
<a name="ln653">        uint8_t cmd = DPS310_MODE_ONE_TEMP_VAL;</a>
<a name="ln654">        err_code |= ctx-&gt;write (ctx-&gt;comm_ctx, DPS310_MEAS_CFG_REG, &amp;cmd, 1U);</a>
<a name="ln655"> </a>
<a name="ln656">        if (DPS310_SUCCESS != err_code)</a>
<a name="ln657">        {</a>
<a name="ln658">            err_code |= DPS310_BUS_ERROR;</a>
<a name="ln659">            ctx-&gt;device_status = DPS310_BUS_ERROR;</a>
<a name="ln660">        }</a>
<a name="ln661">        else</a>
<a name="ln662">        {</a>
<a name="ln663">            ctx-&gt;device_status = DPS310_TEMP_RDY;</a>
<a name="ln664">        }</a>
<a name="ln665">    }</a>
<a name="ln666"> </a>
<a name="ln667">    return err_code;</a>
<a name="ln668">}</a>
<a name="ln669"> </a>
<a name="ln670">dps310_status_t dps310_measure_pres_once_async (dps310_ctx_t * const ctx)</a>
<a name="ln671">{</a>
<a name="ln672">    dps310_status_t err_code = ctx_ready_check (ctx);</a>
<a name="ln673"> </a>
<a name="ln674">    if (DPS310_SUCCESS == err_code)</a>
<a name="ln675">    {</a>
<a name="ln676">        uint8_t cmd = DPS310_MODE_ONE_PRES_VAL;</a>
<a name="ln677">        err_code |= ctx-&gt;write (ctx-&gt;comm_ctx, DPS310_MEAS_CFG_REG, &amp;cmd, 1U);</a>
<a name="ln678"> </a>
<a name="ln679">        if (DPS310_SUCCESS != err_code)</a>
<a name="ln680">        {</a>
<a name="ln681">            err_code |= DPS310_BUS_ERROR;</a>
<a name="ln682">            ctx-&gt;device_status = DPS310_BUS_ERROR;</a>
<a name="ln683">        }</a>
<a name="ln684">        else</a>
<a name="ln685">        {</a>
<a name="ln686">            ctx-&gt;device_status = DPS310_PRES_RDY;</a>
<a name="ln687">        }</a>
<a name="ln688">    }</a>
<a name="ln689"> </a>
<a name="ln690">    return err_code;</a>
<a name="ln691">}</a>
<a name="ln692"> </a>
<a name="ln693">// Datasheet 4.9.3</a>
<a name="ln694">static uint32_t os_to_scale_factor (const dps310_os_t os)</a>
<a name="ln695">{</a>
<a name="ln696">    uint32_t sf = 0;</a>
<a name="ln697"> </a>
<a name="ln698">    switch (os)</a>
<a name="ln699">    {</a>
<a name="ln700">        case DPS310_OS_1:</a>
<a name="ln701">            sf = DPS310_OS_1_SF;</a>
<a name="ln702">            break;</a>
<a name="ln703"> </a>
<a name="ln704">        case DPS310_OS_2:</a>
<a name="ln705">            sf = DPS310_OS_2_SF;</a>
<a name="ln706">            break;</a>
<a name="ln707"> </a>
<a name="ln708">        case DPS310_OS_4:</a>
<a name="ln709">            sf = DPS310_OS_4_SF;</a>
<a name="ln710">            break;</a>
<a name="ln711"> </a>
<a name="ln712">        case DPS310_OS_8:</a>
<a name="ln713">            sf = DPS310_OS_8_SF;</a>
<a name="ln714">            break;</a>
<a name="ln715"> </a>
<a name="ln716">        case DPS310_OS_16:</a>
<a name="ln717">            sf = DPS310_OS_16_SF;</a>
<a name="ln718">            break;</a>
<a name="ln719"> </a>
<a name="ln720">        case DPS310_OS_32:</a>
<a name="ln721">            sf = DPS310_OS_32_SF;</a>
<a name="ln722">            break;</a>
<a name="ln723"> </a>
<a name="ln724">        case DPS310_OS_64:</a>
<a name="ln725">            sf = DPS310_OS_64_SF;</a>
<a name="ln726">            break;</a>
<a name="ln727"> </a>
<a name="ln728">        case DPS310_OS_128:</a>
<a name="ln729">            sf = DPS310_OS_128_SF;</a>
<a name="ln730">            break;</a>
<a name="ln731"> </a>
<a name="ln732">        default:</a>
<a name="ln733">            sf = 1;</a>
<a name="ln734">            break;</a>
<a name="ln735">    }</a>
<a name="ln736"> </a>
<a name="ln737">    return sf;</a>
<a name="ln738">}</a>
<a name="ln739"> </a>
<a name="ln740">static __attribute__ ((nonnull)) float</a>
<a name="ln741">calculate_temperature (dps310_ctx_t * const ctx, const int32_t raw)</a>
<a name="ln742">{</a>
<a name="ln743">    uint32_t sf = os_to_scale_factor (ctx-&gt;temp_osr);</a>
<a name="ln744">    float raw_scaled = ((float) raw) / ((float) sf);</a>
<a name="ln745">    ctx-&gt;last_temp_scal = raw_scaled;</a>
<a name="ln746">    return ((float) ctx-&gt;c0 * DPS310_C0_WEIGHT) + ((float) ctx-&gt;c1 * raw_scaled);</a>
<a name="ln747">}</a>
<a name="ln748"> </a>
<a name="ln749">static __attribute__ ((nonnull))</a>
<a name="ln750">float calculate_pressure (const dps310_ctx_t * const ctx, const int32_t raw)</a>
<a name="ln751">{</a>
<a name="ln752">    uint32_t sf = os_to_scale_factor (ctx-&gt;pres_osr);</a>
<a name="ln753">    float Praw_sc = ((float) raw) / ((float) sf);</a>
<a name="ln754">    float Traw_sc = ctx-&gt;last_temp_scal;</a>
<a name="ln755">    return (float)ctx-&gt;c00</a>
<a name="ln756">           + Praw_sc * ((float) ctx-&gt;c10 + Praw_sc * ((float) ctx-&gt;c20 + Praw_sc *</a>
<a name="ln757">                        (float) ctx-&gt;c30))</a>
<a name="ln758">           + Traw_sc * (float) ctx-&gt;c01 + Traw_sc * Praw_sc * ((float) ctx-&gt;c11 + Praw_sc *</a>
<a name="ln759">                   (float) ctx-&gt;c21);</a>
<a name="ln760">}</a>
<a name="ln761"> </a>
<a name="ln762">static inline __attribute__ ((nonnull)) int32_t</a>
<a name="ln763">regs_to_i32 (const uint8_t * const regs)</a>
<a name="ln764">{</a>
<a name="ln765">    uint32_t b24_value = ((uint32_t)regs[0U] &lt;&lt; 16U)</a>
<a name="ln766">                         + ((uint32_t)regs[1U] &lt;&lt; 8U)</a>
<a name="ln767">                         + ((uint32_t)regs[2U]);</a>
<a name="ln768">    return twos_complement (b24_value, 24U);</a>
<a name="ln769">}</a>
<a name="ln770"> </a>
<a name="ln771">static __attribute__ ((nonnull)) dps310_status_t</a>
<a name="ln772">dps310_get_single_temp (dps310_ctx_t * const ctx, float * const result)</a>
<a name="ln773">{</a>
<a name="ln774">    dps310_status_t err_code = DPS310_SUCCESS;</a>
<a name="ln775">    uint8_t reg_value[DPS310_TEMP_VAL_LEN] = {0};</a>
<a name="ln776">    err_code |= ctx-&gt;read (ctx-&gt;comm_ctx,</a>
<a name="ln777">                           DPS310_TEMP_VAL_REG,</a>
<a name="ln778">                           reg_value,</a>
<a name="ln779">                           DPS310_TEMP_VAL_LEN);</a>
<a name="ln780"> </a>
<a name="ln781">    if (DPS310_SUCCESS == err_code)</a>
<a name="ln782">    {</a>
<a name="ln783">        *result = calculate_temperature (ctx, regs_to_i32 (reg_value));</a>
<a name="ln784">        ctx-&gt;device_status = DPS310_READY;</a>
<a name="ln785">    }</a>
<a name="ln786">    else</a>
<a name="ln787">    {</a>
<a name="ln788">        err_code |= DPS310_BUS_ERROR;</a>
<a name="ln789">        ctx-&gt;device_status = DPS310_BUS_ERROR;</a>
<a name="ln790">    }</a>
<a name="ln791"> </a>
<a name="ln792">    return err_code;</a>
<a name="ln793">}</a>
<a name="ln794"> </a>
<a name="ln795">static __attribute__ ((nonnull)) dps310_status_t</a>
<a name="ln796">dps310_get_single_pres (dps310_ctx_t * const ctx, float * const result)</a>
<a name="ln797">{</a>
<a name="ln798">    dps310_status_t err_code = DPS310_SUCCESS;</a>
<a name="ln799">    uint8_t reg_value[DPS310_PRES_VAL_LEN] = {0};</a>
<a name="ln800">    err_code |= ctx-&gt;read (ctx-&gt;comm_ctx,</a>
<a name="ln801">                           DPS310_PRES_VAL_REG,</a>
<a name="ln802">                           reg_value,</a>
<a name="ln803">                           DPS310_PRES_VAL_LEN);</a>
<a name="ln804"> </a>
<a name="ln805">    if (DPS310_SUCCESS == err_code)</a>
<a name="ln806">    {</a>
<a name="ln807">        *result = calculate_pressure (ctx, regs_to_i32 (reg_value));</a>
<a name="ln808">        ctx-&gt;device_status = DPS310_READY;</a>
<a name="ln809">    }</a>
<a name="ln810">    else</a>
<a name="ln811">    {</a>
<a name="ln812">        err_code |= DPS310_BUS_ERROR;</a>
<a name="ln813">        ctx-&gt;device_status = DPS310_BUS_ERROR;</a>
<a name="ln814">    }</a>
<a name="ln815"> </a>
<a name="ln816">    return err_code;</a>
<a name="ln817">}</a>
<a name="ln818"> </a>
<a name="ln819">dps310_status_t dps310_get_single_result (dps310_ctx_t * const ctx, float * const result)</a>
<a name="ln820">{</a>
<a name="ln821">    dps310_status_t err_code = ctx_done_check (ctx);</a>
<a name="ln822"> </a>
<a name="ln823">    if (DPS310_SUCCESS == err_code)</a>
<a name="ln824">    {</a>
<a name="ln825">        if (DPS310_TEMP_RDY == ctx-&gt;device_status)</a>
<a name="ln826">        {</a>
<a name="ln827">            err_code |= dps310_get_single_temp (ctx, result);</a>
<a name="ln828">        }</a>
<a name="ln829">        else if (DPS310_PRES_RDY == ctx-&gt;device_status)</a>
<a name="ln830">        {</a>
<a name="ln831">            err_code |= dps310_get_single_pres (ctx, result);</a>
<a name="ln832">        }</a>
<a name="ln833">        else</a>
<a name="ln834">        {</a>
<a name="ln835">            // This branch should never run, tested in ctx_done_check</a>
<a name="ln836">            err_code |= DPS310_INVALID_STATE;</a>
<a name="ln837">        }</a>
<a name="ln838">    }</a>
<a name="ln839"> </a>
<a name="ln840">    return err_code;</a>
<a name="ln841">}</a>
<a name="ln842"> </a>
<a name="ln843">dps310_status_t</a>
<a name="ln844">dps310_measure_pres_once_sync (dps310_ctx_t * const ctx, float * const result)</a>
<a name="ln845">{</a>
<a name="ln846">    dps310_status_t err_code = ctx_ready_check (ctx);</a>
<a name="ln847"> </a>
<a name="ln848">    if (NULL == result)</a>
<a name="ln849">    {</a>
<a name="ln850">        err_code = DPS310_ERROR_NULL;</a>
<a name="ln851">    }</a>
<a name="ln852">    else if (DPS310_SUCCESS == err_code)</a>
<a name="ln853">    {</a>
<a name="ln854">        err_code |= dps310_measure_pres_once_async (ctx);</a>
<a name="ln855">        ctx-&gt;sleep (measurement_time_get (ctx-&gt;pres_osr));</a>
<a name="ln856">        err_code |= dps310_get_single_result (ctx, result);</a>
<a name="ln857">    }</a>
<a name="ln858">    else</a>
<a name="ln859">    {</a>
<a name="ln860">        // No action needed.</a>
<a name="ln861">    }</a>
<a name="ln862"> </a>
<a name="ln863">    return err_code;</a>
<a name="ln864">}</a>
<a name="ln865"> </a>
<a name="ln866">dps310_status_t dps310_measure_continuous_async (dps310_ctx_t * const ctx)</a>
<a name="ln867">{</a>
<a name="ln868">    dps310_status_t err_code = ctx_ready_check (ctx);</a>
<a name="ln869">    uint8_t cmd = 0U;</a>
<a name="ln870"> </a>
<a name="ln871">    if (DPS310_SUCCESS == err_code)</a>
<a name="ln872">    {</a>
<a name="ln873">        if (ctx-&gt;temp_mr != DPS310_MR_NONE)</a>
<a name="ln874">        {</a>
<a name="ln875">            cmd |= DPS310_MODE_CONT_TEMP_VAL;</a>
<a name="ln876">        }</a>
<a name="ln877"> </a>
<a name="ln878">        if (ctx-&gt;pres_mr != DPS310_MR_NONE)</a>
<a name="ln879">        {</a>
<a name="ln880">            cmd |= DPS310_MODE_CONT_PRES_VAL;</a>
<a name="ln881">        }</a>
<a name="ln882"> </a>
<a name="ln883">        err_code |= ctx-&gt;write (ctx-&gt;comm_ctx, DPS310_MEAS_CFG_REG, &amp;cmd, 1U);</a>
<a name="ln884"> </a>
<a name="ln885">        if (DPS310_SUCCESS != err_code)</a>
<a name="ln886">        {</a>
<a name="ln887">            err_code |= DPS310_BUS_ERROR;</a>
<a name="ln888">            ctx-&gt;device_status = DPS310_BUS_ERROR;</a>
<a name="ln889">        }</a>
<a name="ln890">        else if (0 != cmd)</a>
<a name="ln891">        {</a>
<a name="ln892">            ctx-&gt;device_status = DPS310_CONTINUOUS;</a>
<a name="ln893">        }</a>
<a name="ln894">        else</a>
<a name="ln895">        {</a>
<a name="ln896">            err_code |= DPS310_INVALID_STATE;</a>
<a name="ln897">        }</a>
<a name="ln898">    }</a>
<a name="ln899"> </a>
<a name="ln900">    return err_code;</a>
<a name="ln901">}</a>
<a name="ln902"> </a>
<a name="ln903">static inline __attribute__ ((nonnull)) bool</a>
<a name="ln904">fifo_entry_is_eof (const uint8_t * const entry)</a>
<a name="ln905">{</a>
<a name="ln906">    return ((DPS310_FIFO_VAL_EOF_B0 ==  entry[0])</a>
<a name="ln907">            &amp;&amp; (DPS310_FIFO_VAL_EOF_B1 ==  entry[1])</a>
<a name="ln908">            &amp;&amp; (DPS310_FIFO_VAL_EOF_B2 ==  entry[2]));</a>
<a name="ln909">}</a>
<a name="ln910"> </a>
<a name="ln911">static inline __attribute__ ((nonnull)) bool</a>
<a name="ln912">fifo_entry_is_pres (const uint8_t * const entry)</a>
<a name="ln913">{</a>
<a name="ln914">    // FIFO entry type is identified by the least significant bit.</a>
<a name="ln915">    return (entry[2] &amp; 0x01U);</a>
<a name="ln916">}</a>
<a name="ln917"> </a>
<a name="ln918">dps310_status_t dps310_get_cont_results (dps310_ctx_t * const ctx, float * const temp,</a>
<a name="ln919">        uint8_t * const temp_count, float * const pres, uint8_t * const pres_count)</a>
<a name="ln920">{</a>
<a name="ln921">    dps310_status_t err_code = ctx_cont_check (ctx);</a>
<a name="ln922">    uint8_t temp_entries = 0U;</a>
<a name="ln923">    uint8_t pres_entries = 0U;</a>
<a name="ln924"> </a>
<a name="ln925">    if (DPS310_SUCCESS == err_code)</a>
<a name="ln926">    {</a>
<a name="ln927">        uint8_t fifo_entry[3U] = {0};</a>
<a name="ln928">        bool output_full = false;</a>
<a name="ln929"> </a>
<a name="ln930">        while ((!fifo_entry_is_eof (fifo_entry)) &amp;&amp; (!output_full)</a>
<a name="ln931">                &amp;&amp; (DPS310_SUCCESS == err_code))</a>
<a name="ln932">        {</a>
<a name="ln933">            err_code |= ctx-&gt;read (ctx-&gt;comm_ctx, DPS310_FIFO_VAL_REG, fifo_entry,</a>
<a name="ln934">                                   DPS310_FIFO_VAL_LEN);</a>
<a name="ln935"> </a>
<a name="ln936">            if (fifo_entry_is_pres (fifo_entry))</a>
<a name="ln937">            {</a>
<a name="ln938">                float result = calculate_pressure (ctx, regs_to_i32 (fifo_entry));</a>
<a name="ln939">                pres[pres_entries++] = result;</a>
<a name="ln940">                output_full = (pres_entries == *pres_count);</a>
<a name="ln941">            }</a>
<a name="ln942">            else if (!fifo_entry_is_eof (fifo_entry))</a>
<a name="ln943">            {</a>
<a name="ln944">                float result = calculate_temperature (ctx, regs_to_i32 (fifo_entry));</a>
<a name="ln945">                temp[temp_entries++] = result;</a>
<a name="ln946">                output_full = (temp_entries == *temp_count);</a>
<a name="ln947">            }</a>
<a name="ln948">            else</a>
<a name="ln949">            {</a>
<a name="ln950">                // EOF</a>
<a name="ln951">                *temp_count = temp_entries;</a>
<a name="ln952">                *pres_count = pres_entries;</a>
<a name="ln953">            }</a>
<a name="ln954"> </a>
<a name="ln955">            if (DPS310_SUCCESS != err_code)</a>
<a name="ln956">            {</a>
<a name="ln957">                err_code |= DPS310_BUS_ERROR;</a>
<a name="ln958">                ctx-&gt;device_status = DPS310_BUS_ERROR;</a>
<a name="ln959">            }</a>
<a name="ln960">        }</a>
<a name="ln961">    }</a>
<a name="ln962"> </a>
<a name="ln963">    return err_code;</a>
<a name="ln964">}</a>
<a name="ln965"> </a>
<a name="ln966">dps310_status_t</a>
<a name="ln967">dps310_get_last_result (dps310_ctx_t * const ctx, float * const temp, float * const pres)</a>
<a name="ln968">{</a>
<a name="ln969">    dps310_status_t err_code = ctx_status_check (ctx);</a>
<a name="ln970"> </a>
<a name="ln971">    if ((NULL == temp) || (NULL == pres))</a>
<a name="ln972">    {</a>
<a name="ln973">        err_code |= DPS310_ERROR_NULL;</a>
<a name="ln974">    }</a>
<a name="ln975">    else if (DPS310_SUCCESS == err_code)</a>
<a name="ln976">    {</a>
<a name="ln977">        uint8_t reg_entry[6U] = {0};</a>
<a name="ln978">        err_code |= ctx-&gt;read (ctx-&gt;comm_ctx, DPS310_PRES_VAL_REG, reg_entry,</a>
<a name="ln979">                               (DPS310_PRES_VAL_LEN + DPS310_TEMP_VAL_LEN));</a>
<a name="ln980">        // Calculate temperature first to update temperature compensation</a>
<a name="ln981">        *temp = calculate_temperature (ctx, regs_to_i32 (reg_entry + DPS310_PRES_VAL_LEN));</a>
<a name="ln982">        *pres = calculate_pressure (ctx, regs_to_i32 (reg_entry));</a>
<a name="ln983"> </a>
<a name="ln984">        if (DPS310_SUCCESS != err_code)</a>
<a name="ln985">        {</a>
<a name="ln986">            err_code |= DPS310_BUS_ERROR;</a>
<a name="ln987">            ctx-&gt;device_status = DPS310_BUS_ERROR;</a>
<a name="ln988">        }</a>
<a name="ln989">    }</a>
<a name="ln990">    else</a>
<a name="ln991">    {</a>
<a name="ln992">        // No action needed</a>
<a name="ln993">    }</a>
<a name="ln994"> </a>
<a name="ln995">    return err_code;</a>
<a name="ln996">}</a>
<a name="ln997">/** @} */</a>

</code></pre>
<div class="balloon" rel="24"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '=' operator should have the same essential type. The current types are: 'unsigned' and 'signed'.</p></div>
<div class="balloon" rel="25"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '=' operator should have the same essential type. The current types are: 'unsigned' and 'signed'.</p></div>
<div class="balloon" rel="26"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '=' operator should have the same essential type. The current types are: 'unsigned' and 'signed'.</p></div>
<div class="balloon" rel="40"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '=' operator should have the same essential type. The current types are: 'floating' and 'signed'.</p></div>
<div class="balloon" rel="219"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x09U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="247"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the 'revision[0U] & (0x0FU)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="248"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(revision[0U] & (0xF0U)) >> (4U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="343"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '~(0x07U << (4U))' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="350"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v684/" target="_blank">V684</a> A value of the variable '* reg' is not modified. Consider inspecting the expression. It is possible that '1' should be present instead of '0'.</p></div>
<div class="balloon" rel="354"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x01U << (4U))' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="358"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x02U << (4U))' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="362"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x03U << (4U))' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="366"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x04U << (4U))' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="370"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x05U << (4U))' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="374"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x06U << (4U))' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="378"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x07U << (4U))' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="393"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '~(0x07U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="402"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x01U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="406"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x02U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="410"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x03U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="414"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x04U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="418"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x05U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="422"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x06U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="426"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x07U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="444"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(value & mask)' expression should not be converted from the essential 'signed' type to the essential 'unsigned' type.</p></div>
<div class="balloon" rel="444"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2544/" target="_blank">V2544</a> The right operand '(value & mask)' of the '|=' operator should not have the essential 'signed' type.</p></div>
<div class="balloon" rel="444"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '|=' operator should have the same essential type. The current types are: 'unsigned' and 'signed'.</p></div>
<div class="balloon" rel="455"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '~(0x80U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="456"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the 'coef_src & (0x80U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="479"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x08U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="519"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x04U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="579"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '1U' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="583"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '2U' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="587"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '4U' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="591"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '8U' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="595"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '16U' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="599"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '32U' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="603"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '64U' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="607"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '128U' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="611"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '=' operator should have the same essential type. The current types are: 'unsigned' and 'signed'.</p></div>
<div class="balloon" rel="621"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2004/" target="_blank">V2004</a> Explicit conversion from 'float' type to unsigned integer type: (uint32_t)(1.6F * (float) os_to_num(os))</p></div>
<div class="balloon" rel="653"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x02U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="676"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x01U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="733"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '=' operator should have the same essential type. The current types are: 'unsigned' and 'signed'.</p></div>
<div class="balloon" rel="875"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x06U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="880"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2572/" target="_blank">V2572</a> The value of the '(0x05U)' expression should not be converted to the narrower essential 'unsigned' type.</p></div>
<div class="balloon" rel="890"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2568/" target="_blank">V2568</a> Both operands of the '!=' operator should have the same essential type. The current types are: 'signed' and 'unsigned'.</p></div>
<div class="balloon" rel="981"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/v2562/" target="_blank">V2562</a> Expressions with pointer type should not be used in the '+', '-', '+=' and '-=' operations.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"]').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"]').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
